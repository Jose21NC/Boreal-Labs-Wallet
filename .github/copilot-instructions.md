# Boreal Labs Wallet – AI Working Notes

- Stack: React 18 + Vite 7 + Tailwind (custom gradients/glass-effect), shadcn/ui primitives, Framer Motion, Capacitor 7 for mobile shells, Firebase Auth/Firestore. Entry in [src/main.jsx](src/main.jsx) renders [src/App.jsx](src/App.jsx).
- Env gating: Firebase config is read from `VITE_FIREBASE_*` vars; [src/lib/firebase.js](src/lib/firebase.js) sets `isFirebaseConfigured`. If missing, [src/App.jsx](src/App.jsx) shows a blocking warning instead of auth/Wallet UI. Keep this guard when touching Firebase logic.
- Auth flow: App subscribes to `onAuthStateChanged`; shows [components/ui/auth/LoginPage.jsx](src/components/ui/auth/LoginPage.jsx) until `user` exists. Login supports Google (web popup/redirect, native via `@capacitor-firebase/authentication`) and email/password (sign-in only). Sign-out handled in [components/ui/layout/AppNavbar.jsx](src/components/ui/layout/AppNavbar.jsx).
- Routing pattern: No router. App infers a `/privacy` path to render [components/ui/layout/privacy/PrivacyPage.jsx](src/components/ui/layout/privacy/PrivacyPage.jsx); otherwise it swaps views via `activeTab` state (`certs`/`points`/`market`). Navbar controls tab; keep this shape if adding screens.
- UI state/providers: [contexts/SettingsContext.jsx](src/contexts/SettingsContext.jsx) manages theme (`dark` default) and sound toggles, persisted in `localStorage`; sound helpers in [src/lib/sound.js](src/lib/sound.js). Toaster is globally mounted in App using the local shadcn-style toast store ([hooks/use-toast.js](src/hooks/use-toast.js)).
- Certificates: [components/ui/wallet/WalletPage.jsx](src/components/ui/wallet/WalletPage.jsx) listens to Firestore `certificados` filtered by email (`userEmail` or `correoUsuario`). Cards rendered via [components/ui/wallet/CertificateCard.jsx](src/components/ui/wallet/CertificateCard.jsx) which validates IDs on borealabs.org and normalizes PDF download URLs; keep multi-shape `urlPdf` handling.
- Points subsystem: [components/ui/points/PointsSection.jsx](src/components/ui/points/PointsSection.jsx) streams balances and movements via [src/lib/points.js](src/lib/points.js). Data model: `userPoints/{uid}` with subcollections `redemptions`, `purchases`, `adminGrants`. Code redemption uses `pointCodes` docs (ID can be code or a `code/id` field) and supports multi-use with `uses/{uid}` subdocs; all mutations run in Firestore transactions. QR scanning via `react-zxing`; camera permission helper exists for Capacitor.
- Marketplace: [components/ui/marketplace/Marketplace.jsx](src/components/ui/marketplace/Marketplace.jsx) listens to `productos` and enables point-based purchases. `purchaseProductTransaction` (in [src/lib/marketplace.js](src/lib/marketplace.js)) decrements stock and balance atomically, writing purchase receipts under `userPoints/{uid}/purchases`. A QR receipt is generated using the public `api.qrserver.com` endpoint; keep payload format (`ID/NAME/QTY/PRICE/TOTAL`).
- Admin mode: Admin flag comes from `isAdmin` collection (email-based) via [src/lib/admin.js](src/lib/admin.js). When `isAdmin` is true, Marketplace auto-enables admin UI for product CRUD and point grants by email (transactional update + `adminGrants` log). Preserve email normalization and defensive checks when modifying these flows.
- Sounds/UX: Sound feedback is opt-in; call `primeSound` on first gesture if adding components. Motion uses `AnimatePresence` for screen swaps and modals; modals typically lock body scroll when open—follow the pattern in Points/Marketplace for new overlays.
- Mobile specifics: [src/App.jsx](src/App.jsx) hides status bar and splash via Capacitor plugins on mount. For live reload or native runs, use npm scripts from README (e.g., `npm run dev:android`, `npm run cap:sync:android`, `npm run cap:open:android`). Build web with `npm run build`; Capacitor copies `dist` when syncing.
- Firestore patterns: Reads are real-time listeners (`onSnapshot`) for user-facing data; writes use `runTransaction` for point-sensitive ops. Document fields are often optional/heterogeneous (e.g., `urlPdf` may be string/object/array); preserve tolerant parsing and fallbacks.
- Styling: Tailwind with custom palette (`boreal-*` colors) and `glass-effect` utility classes (see CSS files). Keep gradients and rounded cards consistent; components assume dark theme.
- Assets/routes: No router; any new public page must be manually switched via pathname check like the privacy page. Favicon and branding assets live under `src/images` and are wired in App `Helmet`.
- Testing: No automated tests present. Validate flows manually (login, code redemption, purchases, admin grants) against Firestore sandbox data.

If anything is unclear or missing, tell me what to elaborate (e.g., Firestore rules, release process, mobile build steps) and I’ll update this file.
